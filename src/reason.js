import { ethers } from 'ethers';

export async function reason() {
  const provider = new ethers.providers.Web3Provider(window.ethereum);
  const a = await provider.getTransaction('0x981a9a4c3418080b604a64bbc528fea4525b0ca76c88cf728d9ec3bdf03f0a5f');
  try {
    let code = await provider.call(a, a.blockNumber);
    console.log("success", code);
  } catch (err) {
    const code = err.data.replace('Reverted ','');
    console.log({err});
    let reason = ethers.utils.toUtf8String('0x' + code.substr(138));
    console.log('revert reason:', reason);
  }
}message
: 
"missing revert data in call exception; Transaction reverted without a reason string [ See: https://links.ethers.org/v5-errors-CALL_EXCEPTION ] (data=\"0x\", transaction={\"from\":\"0x2Efe371AA24D1276B91F8C50C86c2e2D163e966d\",\"gasLimit\":{\"type\":\"BigNumber\",\"hex\":\"0x2dc6c0\"},\"gasPrice\":{\"type\":\"BigNumber\",\"hex\":\"0x3b9aca00\"},\"to\":\"0x5038BB6563b386889f7A4c369Ba621166CDDc0b8\",\"value\":{\"type\":\"BigNumber\",\"hex\":\"0x00\"},\"data\":\"0xb6b55f2500000000000000000000000000000000000000000000010f0cf064dd59200000\",\"accessList\":null}, error={\"code\":-32603,\"message\":\"Internal JSON-RPC error.\",\"data\":{\"code\":-32000,\"message\":\"missing trie node 8d5f733e2d110851dd168e1322fe1e94fcc9e6840a9f376c5cca4605dd33ceb9 (path )\"},\"stack\":\"{\\n  \\\"code\\\": -32603,\\n  \\\"message\\\": \\\"Internal JSON-RPC error.\\\",\\n  \\\"data\\\": {\\n    \\\"code\\\": -32000,\\n    \\\"message\\\": \\\"missing trie node 8d5f733e2d110851dd168e1322fe1e94fcc9e6840a9f376c5cca4605dd33ceb9 (path )\\\"\\n  },\\n  \\\"stack\\\": \\\"Error: Internal JSON-RPC error.\\\\n    at new n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:350264)\\\\n    at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:353020)\\\\n    at Object.internal (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:353630)\\\\n    at n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-2.js:3:103441)\\\\n    at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-2.js:3:104470\\\\n    at async chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:19:40731\\\"\\n}\\n  at new n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:350264)\\n  at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:353020)\\n  at Object.internal (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:353630)\\n  at n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-2.js:3:103441)\\n  at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-2.js:3:104470\\n  at async chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:19:40731\"}, code=CALL_EXCEPTION, version=providers/5.7.2)"
stack
: 
"Error: missing revert data in call exception; Transaction reverted without a reason string [ See: https://links.ethers.org/v5-errors-CALL_EXCEPTION ] (data=\"0x\", transaction={\"from\":\"0x2Efe371AA24D1276B91F8C50C86c2e2D163e966d\",\"gasLimit\":{\"type\":\"BigNumber\",\"hex\":\"0x2dc6c0\"},\"gasPrice\":{\"type\":\"BigNumber\",\"hex\":\"0x3b9aca00\"},\"to\":\"0x5038BB6563b386889f7A4c369Ba621166CDDc0b8\",\"value\":{\"type\":\"BigNumber\",\"hex\":\"0x00\"},\"data\":\"0xb6b55f2500000000000000000000000000000000000000000000010f0cf064dd59200000\",\"accessList\":null}, error={\"code\":-32603,\"message\":\"Internal JSON-RPC error.\",\"data\":{\"code\":-32000,\"message\":\"missing trie node 8d5f733e2d110851dd168e1322fe1e94fcc9e6840a9f376c5cca4605dd33ceb9 (path )\"},\"stack\":\"{\\n  \\\"code\\\": -32603,\\n  \\\"message\\\": \\\"Internal JSON-RPC error.\\\",\\n  \\\"data\\\": {\\n    \\\"code\\\": -32000,\\n    \\\"message\\\": \\\"missing trie node 8d5f733e2d110851dd168e1322fe1e94fcc9e6840a9f376c5cca4605dd33ceb9 (path )\\\"\\n  },\\n  \\\"stack\\\": \\\"Error: Internal JSON-RPC error.\\\\n    at new n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:350264)\\\\n    at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:353020)\\\\n    at Object.internal (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:353630)\\\\n    at n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-2.js:3:103441)\\\\n    at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-2.js:3:104470\\\\n    at async chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:19:40731\\\"\\n}\\n  at new n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:350264)\\n  at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:353020)\\n  at Object.internal (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:12:353630)\\n  at n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-2.js:3:103441)\\n  at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-2.js:3:104470\\n  at async chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:19:40731\"}, code=CALL_EXCEPTION, version=providers/5.7.2)\n    at Logger.makeError (http://localhost:3000/static/js/bundle.js:11585:19)\n    at Logger.throwError (http://localhost:3000/static/js/bundle.js:11594:16)\n    at checkError (http://localhost:3000/static/js/bundle.js:15001:12)\n    at Web3Provider.<anonymous> (http://localhost:3000/static/js/bundle.js:15539:16)\n    at Generator.throw (<anonymous>)\n    at rejected (http://localhost:3000/static/js/bundle.js:14935:32)"
[[Prototype]]
: 
Object